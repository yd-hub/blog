const{OPS:e}=globalThis.pdfjsLib||await import("pdfjs-lib"),t=Object.create(null);for(const n in e)t[e[n]]=n;const n=function(){let e,t=!1;const n="data-font-name";function s(){const e=document.querySelectorAll(`span[${n}]`);for(const t of e)t.className="debuggerHideText"}function a(e,t){const s=document.querySelectorAll(`span[${n}=${e}]`);for(const e of s)e.className=t?"debuggerShowText":"debuggerHideText"}function o(e){if(!e.target.dataset.fontName||"SPAN"!==e.target.tagName.toUpperCase())return;const t=e.target.dataset.fontName,n=document.getElementsByTagName("input");for(const e of n)e.dataset.fontName===t&&(e.checked=!e.checked,a(t,e.checked),e.scrollIntoView())}return{id:"FontInspector",name:"Font Inspector",panel:null,manager:null,init(){const t=this.panel,n=document.createElement("button");n.addEventListener("click",s),n.textContent="Refresh",t.append(n),e=document.createElement("div"),t.append(e)},cleanup(){e.textContent=""},enabled:!1,get active(){return t},set active(e){t=e,t?(document.body.addEventListener("click",o,!0),s()):(document.body.removeEventListener("click",o,!0),function(){const e=document.querySelectorAll(`span[${n}]`);for(const t of e)t.className=""}())},fontAdded(t,n){function o(e,t){const n=document.createElement("table");for(const s of t){const t=document.createElement("tr"),a=document.createElement("td");a.textContent=s,t.append(a);const o=document.createElement("td");o.textContent=e[s].toString(),t.append(o),n.append(t)}return n}const i=t.css?o(t,["baseFontName"]):o(t,["name","type"]),c=t.loadedName,r=document.createElement("div"),l=document.createElement("span");let d;l.textContent=c,t.css||(d=document.createElement("a"),n?(n=/url\(['"]?([^)"']+)/.exec(n),d.href=n[1]):t.data&&(d.href=URL.createObjectURL(new Blob([t.data],{type:t.mimetype}))),d.textContent="Download");const p=document.createElement("a");p.href="",p.textContent="Log",p.addEventListener("click",(function(e){e.preventDefault(),console.log(t)}));const u=document.createElement("input");u.setAttribute("type","checkbox"),u.dataset.fontName=c,u.addEventListener("click",(function(){a(c,u.checked)})),d?r.append(u,l," ",d," ",p,i):r.append(u,l," ",p,i),e.append(r),setTimeout((()=>{this.active&&s()}),2e3)}}}(),s=function(){let e=[],t=null,n=null,s=null,o=Object.create(null);return{id:"Stepper",name:"Stepper",panel:null,manager:null,init(){const e=this;n=document.createElement("div"),s=document.createElement("select"),s.addEventListener("change",(function(t){e.selectStepper(this.value)})),n.append(s),t=document.createElement("div"),this.panel.append(n,t),sessionStorage.getItem("pdfjsBreakPoints")&&(o=JSON.parse(sessionStorage.getItem("pdfjsBreakPoints")))},cleanup(){s.textContent="",t.textContent="",e=[]},enabled:!1,active:!1,create(n){const i=document.createElement("div");i.id="stepper"+n,i.hidden=!0,i.className="stepper",t.append(i);const c=document.createElement("option");c.textContent="Page "+(n+1),c.value=n,s.append(c);const r=o[n]||[],l=new a(i,n,r);return e.push(l),1===e.length&&this.selectStepper(n,!1),l},selectStepper(t,n){t|=0,n&&this.manager.selectPanel(this);for(const n of e)n.panel.hidden=n.pageIndex!==t;for(const e of s.options)e.selected=(0|e.value)===t},saveBreakPoints(e,t){o[e]=t,sessionStorage.setItem("pdfjsBreakPoints",JSON.stringify(o))}}}();class a{#e(e,t){const n=document.createElement(e);return t&&(n.textContent=t),n}#t(e){if("string"==typeof e){const t=75;return e.length<=t?e:e.substring(0,t)+"..."}if("object"!=typeof e||null===e)return e;if("length"in e){const t=10,n=[];let s,a;for(s=0,a=Math.min(t,e.length);s<a;s++)n.push(this.#t(e[s]));return s<e.length&&n.push("..."),n}const t={};for(const n in e)t[n]=this.#t(e[n]);return t}constructor(e,t,n){this.panel=e,this.breakPoint=0,this.nextBreakPoint=null,this.pageIndex=t,this.breakPoints=n,this.currentIdx=-1,this.operatorListIdx=0,this.indentLevel=0}init(e){const t=this.panel,n=this.#e("div","c=continue, s=step"),s=this.#e("table");n.append(s),s.cellSpacing=0;const a=this.#e("tr");s.append(a),a.append(this.#e("th","Break"),this.#e("th","Idx"),this.#e("th","fn"),this.#e("th","args")),t.append(n),this.table=s,this.updateOperatorList(e)}updateOperatorList(e){const n=this;function a(){const e=+this.dataset.idx;this.checked?n.breakPoints.push(e):n.breakPoints.splice(n.breakPoints.indexOf(e),1),s.saveBreakPoints(n.pageIndex,n.breakPoints)}if(this.operatorListIdx>15e3)return;const o=document.createDocumentFragment(),i=Math.min(15e3,e.fnArray.length);for(let n=this.operatorListIdx;n<i;n++){const s=this.#e("tr");s.className="line",s.dataset.idx=n,o.append(s);const i=this.breakPoints.includes(n),c=e.argsArray[n]||[],r=this.#e("td"),l=this.#e("input");l.type="checkbox",l.className="points",l.checked=i,l.dataset.idx=n,l.onclick=a,r.append(l),s.append(r,this.#e("td",n.toString()));const d=t[e.fnArray[n]];let p=c;if("showText"===d){const e=c[0],t=this.#e("tr"),n=this.#e("tr"),s=this.#e("tr");for(const a of e)if("object"==typeof a&&null!==a)t.append(this.#e("td",a.originalCharCode)),n.append(this.#e("td",a.fontChar)),s.append(this.#e("td",a.unicode));else{const e=this.#e("td",a);e.classList.add("advance"),t.append(e),n.append(this.#e("td")),s.append(this.#e("td"))}p=this.#e("td");const a=this.#e("table");a.classList.add("showText"),p.append(a),a.append(t,n,s)}else"restore"===d&&this.indentLevel>0&&this.indentLevel--;s.append(this.#e("td"," ".repeat(2*this.indentLevel)+d)),"save"===d&&this.indentLevel++,p instanceof HTMLElement?s.append(p):s.append(this.#e("td",JSON.stringify(this.#t(p))))}if(i<e.fnArray.length){const e=this.#e("td","...");e.colspan=4,o.append(e)}this.operatorListIdx=e.fnArray.length,this.table.append(o)}getNextBreakPoint(){this.breakPoints.sort((function(e,t){return e-t}));for(const e of this.breakPoints)if(e>this.currentIdx)return e;return null}breakIt(e,t){s.selectStepper(this.pageIndex,!0),this.currentIdx=e;const n=e=>{switch(e.keyCode){case 83:document.removeEventListener("keydown",n),this.nextBreakPoint=this.currentIdx+1,this.goTo(-1),t();break;case 67:document.removeEventListener("keydown",n),this.nextBreakPoint=this.getNextBreakPoint(),this.goTo(-1),t()}};document.addEventListener("keydown",n),this.goTo(e)}goTo(e){const t=this.panel.getElementsByClassName("line");for(const n of t)(0|n.dataset.idx)===e?(n.style.backgroundColor="rgb(251,250,207)",n.scrollIntoView()):n.style.backgroundColor=null}}const o=function(){let e=[];function t(e){e.textContent=""}return{id:"Stats",name:"Stats",panel:null,manager:null,init(){},enabled:!1,active:!1,add(n,s){if(!s)return;const a=function(t){for(const[n,s]of e.entries())if(s.pageNumber===t)return n;return!1}(n);!1!==a&&(e[a].div.remove(),e.splice(a,1));const o=document.createElement("div");o.className="stats";const i=document.createElement("div");i.className="title",i.textContent="Page: "+n;const c=document.createElement("div");c.textContent=s.toString(),o.append(i,c),e.push({pageNumber:n,div:o}),e.sort((function(e,t){return e.pageNumber-t.pageNumber})),t(this.panel);for(const t of e)this.panel.append(t.div)},cleanup(){e=[],t(this.panel)}}}();class i{static#n=[];static#s=null;static tools=[n,s,o];static enable(e){const t=1===e.length&&"all"===e[0],n=this.tools;for(const s of n)(t||e.includes(s.id))&&(s.enabled=!0);t||n.sort((function(t,s){let a=e.indexOf(t.id);a=a<0?n.length:a;let o=e.indexOf(s.id);return o=o<0?n.length:o,a-o}))}static init(e,t){this.loadCSS(),this.enable(t);const n=document.createElement("div");n.id="PDFBug";const s=document.createElement("div");s.setAttribute("class","controls"),n.append(s);const a=document.createElement("div");a.setAttribute("class","panels"),n.append(a),e.append(n),e.style.right="var(--panel-width)";for(const e of this.tools){const t=document.createElement("div"),n=document.createElement("button");n.textContent=e.name,n.addEventListener("click",(t=>{t.preventDefault(),this.selectPanel(e)})),s.append(n),a.append(t),e.panel=t,e.manager=this,e.enabled?e.init():t.textContent=`${e.name} is disabled. To enable add "${e.id}" to the pdfBug parameter and refresh (separate multiple by commas).`,this.#n.push(n)}this.selectPanel(0)}static loadCSS(){const{url:e}=import.meta,t=document.createElement("link");t.rel="stylesheet",t.href=e.replace(/\.mjs$/,".css"),document.head.append(t)}static cleanup(){for(const e of this.tools)e.enabled&&e.cleanup()}static selectPanel(e){if("number"!=typeof e&&(e=this.tools.indexOf(e)),e!==this.#s){this.#s=e;for(const[t,n]of this.tools.entries()){const s=t===e;this.#n[t].classList.toggle("active",s),n.active=s,n.panel.hidden=!s}}}}globalThis.FontInspector=n,globalThis.StepperManager=s,globalThis.Stats=o;export{i as PDFBug};